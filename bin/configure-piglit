#!/bin/bash
set -e
platform checkactive
build_dir="$PLATFORM_ROOT_DIR/piglit"
if [ -d "$build_dir" ]; then
    rm -rf "$build_dir"
fi
mkdir -p "$build_dir"
cd "$build_dir"
mkdir -p source
pushd source
git init
git fetch "$HOME/piglit" HEAD
git reset --hard FETCH_HEAD
popd
mkdir -p build
cd build
cmake \
    -DCMAKE_BUILD_TYPE=debug \
    -DCMAKE_C_FLAGS_DEBUG="-g -O0" \
    -DCMAKE_CXX_FLAGS_DEBUG="-g -O0" \
    -DCMAKE_EXE_LINKER_FLAGS="-lselinux" \
    "-DCMAKE_INSTALL_PREFIX=$PLATFORM_INSTALL_DIR" \
    ../source
cd "$build_dir/source"
git tag -f configure
